# NapCat QQåè®®æ’ä»¶

åŸºäºOneBot 11åè®®çš„NapCat QQåè®®æ’ä»¶ï¼Œä¸ºMaiBotæä¾›å®Œæ•´çš„QQæœºå™¨äººAPIæ¥å£ï¼Œ**ä½¿ç”¨WebSocketåè®®**ä¸NapCaté€šä¿¡ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **æ¶ˆæ¯ç®¡ç†**: å‘é€å’Œæ¥æ”¶ç§èŠ/ç¾¤èŠæ¶ˆæ¯
- **ç¾¤ç®¡ç†**: è·å–ç¾¤åˆ—è¡¨ã€ç¾¤æˆå‘˜ä¿¡æ¯ã€ç¾¤ç­¾åˆ°ã€æˆ³ä¸€æˆ³
- **å¥½å‹ç®¡ç†**: è·å–å¥½å‹åˆ—è¡¨ã€åˆ†ç±»å¥½å‹ã€æˆ³ä¸€æˆ³
- **æ–‡ä»¶æ“ä½œ**: æ–‡ä»¶ä¸Šä¼ ã€è·å–æ–‡ä»¶ä¿¡æ¯
- **æ¶ˆæ¯æ“ä½œ**: è·å–æ¶ˆæ¯è¯¦æƒ…ã€è½¬å‘æ¶ˆæ¯
- **WebSocketåè®®**: ä½¿ç”¨WebSocketåè®®ä¸NapCaté€šä¿¡ï¼Œæ— éœ€HTTP API

## ğŸ“ é¡¹ç›®ç»“æ„

```
plugins/napcat_plugin/
â”œâ”€â”€ ws_client.py             # WebSocketå®¢æˆ·ç«¯ç®¡ç†å™¨
â”œâ”€â”€ server_manager.py        # ç»Ÿä¸€æœåŠ¡å™¨ç®¡ç†å™¨
â”œâ”€â”€ utils/                   # å·¥å…·æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ message_utils.py     # æ¶ˆæ¯å‘é€å·¥å…· (WebSocket)
â”‚   â”œâ”€â”€ group_utils.py       # ç¾¤ç®¡ç†å·¥å…· (WebSocket)
â”‚   â”œâ”€â”€ friend_utils.py      # å¥½å‹ç®¡ç†å·¥å…· (WebSocket)
â”‚   â”œâ”€â”€ file_utils.py        # æ–‡ä»¶æ“ä½œå·¥å…· (WebSocket)
â”‚   â””â”€â”€ message_ops_utils.py # æ¶ˆæ¯æ“ä½œå·¥å…· (WebSocket)
â”œâ”€â”€ plugin.py (é‡æ„)         # ä¸»æ’ä»¶æ–‡ä»¶
â”œâ”€â”€ _manifest.json (æ›´æ–°)    # æ’ä»¶æ¸…å•
â”œâ”€â”€ README.md (æ›´æ–°)        # å®Œæ•´æ–‡æ¡£
â””â”€â”€ template/template_config.toml (æ›´æ–°) # é…ç½®æ¨¡æ¿
```

## âš™ï¸ é…ç½®è¯´æ˜

### åŸºæœ¬é…ç½®
åœ¨ `config.toml` ä¸­é…ç½®ï¼š

```toml
[napcat]
# NapCat WebSocketé…ç½®
api_base_url = "ws://localhost:3000"  # ä½¿ç”¨WebSocketåè®®
access_token = ""                     # è®¿é—®ä»¤ç‰Œï¼ˆå¯é€‰ï¼‰

[napcat.server]
host = "127.0.0.1"  # ç›‘å¬åœ°å€
port = 3001         # ç›‘å¬ç«¯å£

[napcat.connection]
timeout = 30        # è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
max_retries = 3     # æœ€å¤§é‡è¯•æ¬¡æ•°
retry_delay = 1.0   # é‡è¯•å»¶è¿Ÿï¼ˆç§’ï¼‰
```

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨æ’ä»¶
æ’ä»¶ä¼šåœ¨MaiBotå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨NapCatæœåŠ¡å™¨ï¼Œå¹¶å»ºç«‹WebSocketè¿æ¥ã€‚

### 2. ä½¿ç”¨å·¥å…·
é€šè¿‡NapCatToolä½¿ç”¨å„é¡¹åŠŸèƒ½ï¼Œæ‰€æœ‰æ“ä½œéƒ½é€šè¿‡WebSocketåè®®ï¼š

```python
# å‘é€æ¶ˆæ¯
await napcat_tool.execute({
    "action": "send_message",
    "params": {
        "type": "group",
        "target_id": 123456789,
        "message": "Hello, World!"
    }
})

# è·å–ç¾¤åˆ—è¡¨
await napcat_tool.execute({
    "action": "get_groups",
    "params": {}
})

# è·å–ç¾¤æˆå‘˜
await napcat_tool.execute({
    "action": "get_group_members",
    "params": {"group_id": 123456789}
})
```

### 3. ç›´æ¥è°ƒç”¨å·¥å…·æ¨¡å—
ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å·¥å…·æ¨¡å—çš„ç‹¬ç«‹æ–¹æ³•ï¼š

```python
from plugins.napcat_plugin.utils import MessageUtils, GroupUtils

# ä½¿ç”¨æ¶ˆæ¯å·¥å…·
await MessageUtils.send_message({
    "type": "private",
    "target_id": 123456789,
    "message": "Hello!"
})

# ä½¿ç”¨ç¾¤ç®¡ç†å·¥å…·
await GroupUtils.get_groups({})
```

## ğŸ“‹ æ”¯æŒçš„æ“ä½œ

### æ¶ˆæ¯æ“ä½œ
- `send_message`: å‘é€æ¶ˆæ¯
- `get_message`: è·å–æ¶ˆæ¯è¯¦æƒ…
- `forward_message`: è½¬å‘æ¶ˆæ¯

### ç¾¤ç®¡ç†
- `get_groups`: è·å–ç¾¤åˆ—è¡¨
- `get_group_members`: è·å–ç¾¤æˆå‘˜åˆ—è¡¨
- `group_sign`: ç¾¤ç­¾åˆ°
- `group_poke`: ç¾¤æˆ³ä¸€æˆ³

### å¥½å‹ç®¡ç†
- `get_friends`: è·å–å¥½å‹åˆ—è¡¨
- `get_friends_with_category`: è·å–åˆ†ç±»å¥½å‹åˆ—è¡¨
- `friend_poke`: å¥½å‹æˆ³ä¸€æˆ³

### æ–‡ä»¶æ“ä½œ
- `upload_file`: ä¸Šä¼ æ–‡ä»¶
- `get_file_info`: è·å–æ–‡ä»¶ä¿¡æ¯

## ğŸ”§ æŠ€æœ¯æ¶æ„

### WebSocketé€šä¿¡
- **åè®®**: WebSocket (ws://)
- **æ¶ˆæ¯æ ¼å¼**: JSON
- **é€šä¿¡æ¨¡å¼**: è¯·æ±‚-å“åº”æ¨¡å¼
- **è¿æ¥ç®¡ç†**: è‡ªåŠ¨é‡è¿å’Œé”™è¯¯å¤„ç†

### æ¶ˆæ¯æ ¼å¼
```json
{
  "action": "send_group_msg",
  "params": {
    "group_id": 123456789,
    "message": "Hello"
  },
  "echo": "unique_id"
}
```

## ğŸ”„ ä»HTTPè¿ç§»åˆ°WebSocket

### ä¸»è¦å˜åŒ–
- âœ… **ç§»é™¤HTTP APIä¾èµ–**: ä¸å†ä½¿ç”¨aiohttpå’ŒHTTPè¯·æ±‚
- âœ… **WebSocketåè®®**: æ‰€æœ‰é€šä¿¡é€šè¿‡WebSocketè¿›è¡Œ
- âœ… **å®æ—¶é€šä¿¡**: æ›´ä½çš„å»¶è¿Ÿå’Œæ›´å¥½çš„å®æ—¶æ€§
- âœ… **ç»Ÿä¸€è¿æ¥**: æ‰€æœ‰å·¥å…·å…±äº«åŒä¸€ä¸ªWebSocketè¿æ¥

### å‘åå…¼å®¹
- âœ… **APIæ¥å£ä¸å˜**: ä¿æŒåŸæœ‰çš„NapCatToolæ¥å£
- âœ… **å‚æ•°æ ¼å¼ä¸å˜**: ä¿æŒåŸæœ‰çš„å‚æ•°æ ¼å¼
- âœ… **å“åº”æ ¼å¼ä¸å˜**: ä¿æŒåŸæœ‰çš„å“åº”æ ¼å¼

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **è¿æ¥å¤±è´¥**: æ£€æŸ¥NapCatæœåŠ¡æ˜¯å¦è¿è¡Œï¼ŒWebSocketåœ°å€æ˜¯å¦æ­£ç¡®
2. **æƒé™é”™è¯¯**: æ£€æŸ¥access_tokenæ˜¯å¦æ­£ç¡®é…ç½®
3. **æ¶ˆæ¯å‘é€å¤±è´¥**: æ£€æŸ¥ç›®æ ‡IDæ˜¯å¦æ­£ç¡®ï¼Œæœºå™¨äººæ˜¯å¦æœ‰æƒé™

### æ—¥å¿—æŸ¥çœ‹
æŸ¥çœ‹ `logs/napcat.log` è·å–è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚

## ğŸ“„ æ›´æ–°æ—¥å¿—

### v2.2.0
- âœ… **é‡å¤§æ›´æ–°**: ä»HTTP APIè¿ç§»åˆ°WebSocketåè®®
- âœ… **ç§»é™¤HTTPä¾èµ–**: å®Œå…¨ç§»é™¤aiohttpå’ŒHTTP API
- âœ… **WebSocketæ”¯æŒ**: æ‰€æœ‰å·¥å…·æ¨¡å—ä½¿ç”¨WebSocketåè®®
- âœ… **æ€§èƒ½ä¼˜åŒ–**: æ›´ä½çš„å»¶è¿Ÿå’Œæ›´å¥½çš„å®æ—¶æ€§
- âœ… **ä»£ç é‡æ„**: æ›´æ¸…æ™°çš„æ¶æ„å’Œæ›´å¥½çš„å¯ç»´æŠ¤æ€§

### v2.1.0
- âœ… é‡æ„ä¸ºæ¨¡å—åŒ–æ¶æ„
- âœ… åˆ›å»ºç»Ÿä¸€çš„æœåŠ¡å™¨ç®¡ç†å™¨
- âœ… æ‹†åˆ†åŠŸèƒ½åˆ°ç‹¬ç«‹å·¥å…·æ¨¡å—

### v2.0.0
- âœ… é›†æˆNapcatAdapteråˆ°æ’ä»¶
- âœ… æä¾›å®Œæ•´çš„QQåè®®API

## ğŸ¤ è´¡çŒ®
æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯
MIT License